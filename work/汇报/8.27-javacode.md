package com.luo;

import java.util.Arrays;
import java.util.Random;
class MyThread extends Thread {
    private int l,r;
    private int[] nums;

    public MyThread(int[] nums,int l,int r) {
        this.l = l;
        this.r = r;
        this.nums = nums;
    }
    @Override
    public void run() {
        quickSort(nums,l,r);
    }
    public static void quickSort(int[] nums, int l, int r) {
        if (l < r) {
            int pivotIndex = partition(nums, l, r);
            quickSort(nums, l, pivotIndex - 1);
            quickSort(nums, pivotIndex + 1, r);
        }
    }

    private static int partition(int[] nums, int l, int r) {
        int pivot = nums[r];
        int i = l - 1;
        for (int j = l; j < r; j++) {
            if (nums[j] < pivot) {
                i++;
                swap(nums, i, j);
            }
        }
        swap(nums, i + 1, r);
        return i + 1;
    }

    private static void swap(int[] nums, int i, int j) {
        int temp = nums[i];
        nums[i] = nums[j];
        nums[j] = temp;
    }
}

public class main {
    public static void main(String[] args) {
        int[] nums = getNums();
        int cnt = 0;
        for (int i = 0; i < 10; i++) {
            int[] ints1 = Arrays.copyOf(nums, nums.length);
            int[] ints2 = Arrays.copyOf(nums, nums.length);
            int[] ints3 = Arrays.copyOf(nums, nums.length);
            long duration1 = oneThread(ints1);
            long duration2 = twoThread(ints2);
            long duration3 = threeThread(ints3);
            if (duration1>duration2&&duration2>duration3) cnt++;
            System.out.println("单线程：" + duration1+ " 双线程：" + duration2 + "三线程：" + duration3);
            System.out.println(cnt + "/" + i);
        }
    }
    public static long oneThread(int[] nums){
        int x1 = 0,x2 = nums.length-1;
        MyThread thread1 = new MyThread(nums,x1,x2);
        long startTime = System.currentTimeMillis();
        thread1.start();
        try {
            // 等待线程执行完毕
            thread1.join();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }

        long endTime = System.currentTimeMillis();
        return endTime - startTime;
    }
    public static long twoThread(int[] nums){
        int[] mnums = new int[nums.length];
        int x = nums.length/2;
        int x1 = x*0,x2=x*1,x3=nums.length-1;
        MyThread thread1 = new MyThread(nums,x1,x2);
        MyThread thread2 = new MyThread(nums,x2+1,x3);
        long startTime = System.currentTimeMillis();
        thread1.start();
        thread2.start();
        try {
            // 等待线程执行完毕
            thread1.join();
            thread2.join();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        nums = merge(nums,x1,x2,x3,mnums);
        long endTime = System.currentTimeMillis();
        return endTime - startTime;
    }
    public static long threeThread(int[] nums){
        int[] mnums = new int[nums.length];
        int x = nums.length/3;
        int x1 = x*0,x2=x*1,x3=x*2,x4=nums.length-1;
        MyThread thread1 = new MyThread(nums,x1,x2);
        MyThread thread2 = new MyThread(nums,x2+1,x3);
        MyThread thread3 = new MyThread(nums,x3+1,x4);
        long startTime = System.currentTimeMillis();
        thread1.start();
        thread2.start();
        thread3.start();
        try {
            // 等待线程执行完毕
            thread1.join();
            thread2.join();
            thread3.join();
        } catch (InterruptedException e) {
            e.printStackTrace();
        }
        nums = merge(nums,x1,x2,x3,mnums);
        nums = merge(nums,x1,x3,x4,mnums);
        long endTime = System.currentTimeMillis();
        return endTime - startTime;
    }
    public static int[] merge(int[] nums, int l, int m, int r,int[] arr) {
        int i = l;
        int j = m + 1;
        int n = 0;

        while (i <= m && j <= r) {
            if(nums[i]<=nums[j]){
                arr[n++] = nums[i++];
            }else {
                arr[n++] = nums[j++];
            }
        }
        while(i <= m){
            arr[n++] = nums[i++];
        }
        while(j<=r){
            arr[n++] = nums[j++];
        }
        return arr;
    }
    public static int[] getNums() {
        int[] nums = new int[1000000];
        Random random = new Random();
        for(int i = 0;i < 1000000;i++){
            int randomNumber = random.nextInt(1000000);
            nums[i] = randomNumber;
        }
        return nums;
    }
}
